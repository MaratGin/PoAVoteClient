<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Детали голосования</title>
  <link rel="stylesheet" href="voteDetails.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1 class="vote-name" >Тестовое голосование</h1>

  <div class="container">
    <div class="right-column">
      <canvas id="voteChart"></canvas>
      <div class="button-container">
        <button id="backToMenuButton">Вернуться в меню</button>
        <button id="viewBlocksButton">Просмотр блоков</button>
      </div>
    </div>
    <div class="left-column">
      <h1>Голоса избирателей</h1>
      <ul id="voteList">
        <!-- <li>Пользователь А проголосовал за вариант Б</li>
        <li>Пользователь В проголосовал за вариант Г</li>
        <li>Пользователь С проголосовал за вариант Д</li>
        <li>Пользователь Д проголосовал за вариант А</li> -->
      </ul>
    </div>
  </div>

  <script>
    let history = [];
    let value = 0;
    document.getElementById('backToMenuButton').addEventListener('click', () => {
      window.location.href = 'otherMenu.html';
    });

    document.getElementById('viewBlocksButton').addEventListener('click', () => {
      window.electron.send('navigate-to', 'dist/detailedBlock.html');
    });

    // const ctx = document.getElementById('voteChart').getContext('2d');

    // const voteChart = new Chart(ctx, {
    //   type: 'bar',
    //   data: {
    //     labels: ['Вариант А', 'Вариант Б', 'Вариант В', 'Вариант Г'],
    //     datasets: [{
    //       label: 'Количество голосов',
    //       data: [12, 19, 3, 5],
    //       backgroundColor: [
    //         'rgba(75, 192, 192, 0.2)',
    //         'rgba(54, 162, 235, 0.2)',
    //         'rgba(255, 206, 86, 0.2)',
    //         'rgba(153, 102, 255, 0.2)'
    //       ],
    //       borderColor: [
    //         'rgba(75, 192, 192, 1)',
    //         'rgba(54, 162, 235, 1)',
    //         'rgba(255, 206, 86, 1)',
    //         'rgba(153, 102, 255, 1)'
    //       ],
    //       borderWidth: 1
    //     }]
    //   },
    //   options: {
    //     scales: {
    //       y: {
    //         beginAtZero: true
    //       }
    //     }
    //   }
    // });

    window.addEventListener('DOMContentLoaded', async () => {
      let moscow = 0;
      let kazan = 0;
      let vladivostok = 0;
      try {
        const response = await fetch('http://127.0.0.1:10098/getHistory');
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        history = await response.json();
        console.log(history[0].choice);

        value = history.length;
 


        const voteList = document.getElementById('voteList');
        history.forEach(entry => {
          const listItem = document.createElement('li');
          listItem.textContent = `${entry.voter} проголосовал за ${entry.choice}\n`;
          if (entry.choice == "Москва") {
            moscow = moscow + 1;
          }
          if (entry.choice == "Владивосток") {
            vladivostok = vladivostok + 1;
          }
          if (entry.choice == "Казань") {
            kazan = kazan + 1;
          }

          voteList.appendChild(listItem);


        });
      } catch (error) {
        console.error('Error fetching history:', error);
      }

      const ctx = document.getElementById('voteChart').getContext('2d');
   
   const voteChart = new Chart(ctx, {
     type: 'bar',
     data: {
       labels: ['Москва', 'Казань', 'Владивосток'],
       datasets: [{
         label: 'Количество голосов',
         backgroundColor: [
           'rgba(75, 192, 192, 0.2)',
           'rgba(54, 162, 235, 0.2)',
           'rgba(255, 206, 86, 0.2)',
         ],
         borderColor: [
           'rgba(75, 192, 192, 1)',
           'rgba(54, 162, 235, 1)',
           'rgba(255, 206, 86, 1)',
         ],
         data: [moscow, kazan, vladivostok],
         borderWidth: 1
       }]
     },
     options: {
       scales: {
         y: {
           beginAtZero: true
         }
       }
     }
   });


    });


  </script>
</body>
</html>
