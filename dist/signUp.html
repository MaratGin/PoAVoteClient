<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Registration</title>
    <link rel="stylesheet" href="signUp.css">
  </head>
  <body>
    <h1>PoAVote: Регистрация</h1>
    <form id="registrationForm">
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required>
      <span id="usernameError" class="error-message"></span>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      <span id="emailError" class="error-message"></span>

      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required>

      <label for="confirmPassword">Confirm Password:</label>
      <input type="password" id="confirmPassword" name="confirmPassword" required>
      <span id="passwordError" class="error-message"></span>

      <button id="submition" type="submit"> Регистрация</button>
    </form>

    <!-- <button id="example">Присоединиться к голосованию</button> -->


    <script>
        // const { ipcRenderer } = require('electron');
           
      //   document.getElementById('example').addEventListener('click', () => {
      //   console.log("SUB" + ipcRenderer);
      //   ipcRenderer.send('moveToMain');
      // });

        document.getElementById('registrationForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        document.getElementById('usernameError').textContent = '';
        document.getElementById('emailError').textContent = '';
        document.getElementById('passwordError').textContent = '';

        // Validate username
        const username = document.getElementById('username').value;
        const usernameRegex = /^[a-zA-Z0-9]+$/;
        console.log("123")

        
        if (!usernameRegex.test(username)) {
          document.getElementById('usernameError').textContent = 'Username must contain only letters and numbers.';
          return;
        }

        // Validate email
        const email = document.getElementById('email').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          document.getElementById('emailError').textContent = 'Please enter a valid email address.';
          return;
        }

        // Validate password
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        if (password !== confirmPassword) {
          document.getElementById('passwordError').textContent = 'Passwords do not match.';
          return;
        }

        const registrationData = {
        username: username,
        email: email,
        password: password
      };

        try {
        const response = await fetch('http://127.0.0.1:9090/user', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(registrationData)
        });
        
        if (response.ok) {
          // const result = await response.json();
          alert('Регистрация прошла успешно!');
          const saveSession =  await window.electron.invoke('save-session', registrationData);
          window.electron.send('navigate-to', 'dist/otherMenu.html');
        } else {
          const error = await response.json();
          alert(`Ошибка: ${error.message}`);
        }
      } catch (error) {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при регистрации');
      }
      });

    </script>
  </body>
</html>
